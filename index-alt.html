<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveTrader.ai - Pattern Recognition Trading Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="manifest" href="assets/site.webmanifest">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1e3a8a 100%);
            color: #ffffff;
            overflow-x: hidden;
            padding-bottom: 60px; /* Space for fixed news ticker */
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(30, 58, 138, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid rgba(220, 38, 38, 0.3);
        }

        nav {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            padding: 1rem 0;
            gap: 2rem;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #dc2626;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .logo:hover {
            color: #b91c1c;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #dc2626;
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
        }

        .dropdown-toggle {
            cursor: pointer;
            user-select: none;
        }

        .dropdown-toggle:hover,
        .dropdown-toggle:focus {
            color: #dc2626;
        }

        /* Financial News Ticker */
        .financial-news-ticker {
            background: linear-gradient(90deg, #1e3a8a 0%, #1e40af 50%, #1d4ed8 100%);
            border-top: 2px solid rgba(59, 130, 246, 0.3);
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            overflow: hidden;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        
        .news-ticker-wrapper {
            height: 100%;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .news-ticker-content {
            display: flex;
            align-items: center;
            gap: 4rem;
            animation: scroll-financial-news 150s linear infinite;
            white-space: nowrap;
            padding-left: 100%;
        }
        
        .news-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #ffffff;
            font-size: 0.95rem;
            font-weight: 500;
            min-width: max-content;
        }
        
        .news-badge {
            background: rgba(255, 255, 255, 0.15);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
        }
        
        .news-item.breaking .news-badge {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            animation: pulse-breaking 2s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
        }
        
        .news-item.market .news-badge {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        
        .news-item.crypto .news-badge {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
        }
        
        .news-item.earnings .news-badge {
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
        }
        
        .news-item.ai-insight .news-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            animation: pulse-ai 3s ease-in-out infinite;
        }
        
        .news-item.global .news-badge {
            background: linear-gradient(135deg, #ea580c 0%, #f97316 100%);
        }
        
        .news-item.commodities .news-badge {
            background: linear-gradient(135deg, #ca8a04 0%, #eab308 100%);
            color: #000000;
        }
        
        .news-text {
            color: #e5e7eb;
            line-height: 1.4;
            font-weight: 400;
        }
        
        @keyframes scroll-financial-news {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        
        @keyframes pulse-breaking {
            0%, 100% {
                box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 20px rgba(220, 38, 38, 0.8);
                transform: scale(1.05);
            }
        }
        
        @keyframes pulse-ai {
            0%, 100% {
                box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
            }
            50% {
                box-shadow: 0 0 16px rgba(245, 158, 11, 0.7);
            }
        }

        /* Rotating Market Tickers */
        .market-toggles {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 0.5rem 1rem;
            backdrop-filter: blur(10px);
        }

        .rotating-ticker-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            min-width: 180px;
        }

        .rotating-ticker-container:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(220, 38, 38, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .ticker-label {
            font-size: 0.65rem;
            font-weight: 700;
            color: #dc2626;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 50px;
            text-align: center;
            background: rgba(220, 38, 38, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 8px;
            border: 1px solid rgba(220, 38, 38, 0.2);
        }

        .rotating-ticker-content {
            position: relative;
            height: 45px;
            overflow: hidden;
            flex: 1;
        }

        .ticker-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.15rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .ticker-item.active {
            opacity: 1;
            transform: translateY(0);
        }

        .ticker-symbol {
            font-size: 0.7rem;
            font-weight: 600;
            color: #e5e7eb;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .ticker-price {
            font-size: 0.85rem;
            font-weight: 700;
            color: #ffffff;
            font-family: 'Courier New', monospace;
        }

        .ticker-change {
            font-size: 0.65rem;
            font-weight: 500;
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
        }

        .ticker-change.positive {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .ticker-change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Rotation Animation */
        @keyframes tickerRotate {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            25% {
                opacity: 0;
                transform: translateY(-20px);
            }
            75% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: #ffffff;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            min-width: 300px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            margin-top: 0.5rem;
            padding: 0.5rem 0;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }

        .dropdown:hover .dropdown-menu,
        .dropdown-menu:hover {
            opacity: 1;
            visibility: visible;
        }

        .dropdown-category {
            display: block;
            padding: 1rem 1.5rem;
            color: #1f2937 !important;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            background: transparent;
        }

        .dropdown-category:last-child {
            border-bottom: none;
        }

        .dropdown-category:hover {
            background: #f3f4f6 !important;
            color: #1f2937 !important;
        }

        .dropdown-category:visited {
            color: #1f2937 !important;
        }

        /* Historical Periods Dropdown */
        .dropdown-period {
            display: block;
            padding: 1rem 1.5rem;
            color: #1f2937 !important;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            background: transparent;
        }

        .dropdown-period:last-child {
            border-bottom: none;
        }

        .dropdown-period:hover {
            background: #e0f2fe !important;
            color: #1e3a8a !important;
        }

        .dropdown-period:visited {
            color: #1f2937 !important;
        }

        .search-menu {
            min-width: 200px;
        }

        .patterns-menu {
            min-width: 300px;
        }

        /* NYC Time Toggle */
        .nyc-time-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 25px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nyc-time-toggle:hover {
            background: rgba(220, 38, 38, 0.2);
            border-color: rgba(220, 38, 38, 0.5);
        }

        .american-flag {
            width: 20px;
            height: 14px;
            background: linear-gradient(to bottom, 
                #b22234 0%, #b22234 7.7%, 
                #ffffff 7.7%, #ffffff 15.4%, 
                #b22234 15.4%, #b22234 23.1%, 
                #ffffff 23.1%, #ffffff 30.8%, 
                #b22234 30.8%, #b22234 38.5%, 
                #ffffff 38.5%, #ffffff 46.2%, 
                #b22234 46.2%, #b22234 53.9%, 
                #ffffff 53.9%, #ffffff 61.6%, 
                #b22234 61.6%, #b22234 69.3%, 
                #ffffff 69.3%, #ffffff 77%, 
                #b22234 77%, #b22234 84.7%, 
                #ffffff 84.7%, #ffffff 92.4%, 
                #b22234 92.4%, #b22234 100%);
            position: relative;
            border-radius: 2px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .american-flag::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 40%;
            height: 53.8%;
            background: #3c3b6e;
            border-radius: 1px 0 0 0;
        }

        .american-flag::after {
            content: '★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★';
            position: absolute;
            top: 1px;
            left: 1px;
            width: 38%;
            height: 51.8%;
            font-size: 1.5px;
            line-height: 1.8px;
            color: #ffffff;
            overflow: hidden;
            letter-spacing: 0.3px;
        }

        .nyc-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc2626;
            animation: pulse 2s infinite;
        }

        .nyc-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .nyc-location {
            font-size: 0.75rem;
            color: #b8c5d6;
            font-weight: 500;
        }

        .nyc-time {
            font-size: 0.9rem;
            color: #ffffff;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .market-status {
            font-size: 0.65rem;
            color: #dc2626;
            font-weight: 600;
            margin-top: 1px;
        }

        /* Hero Section - Full Page Interface */
        .hero {
            padding-top: 80px;
            background: #ffffff;
            min-height: calc(100vh - 80px);
        }

        .full-interface {
            width: 100%;
            min-height: calc(100vh - 80px);
        }

        /* GPT-Style Layout */
        .gpt-layout {
            display: flex;
            height: calc(100vh - 80px);
            background: #ffffff;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 1.5rem;
        }

        .highlight {
            color: #dc2626;
        }

        .hero p {
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 3rem;
            color: #b8c5d6;
        }



        /* Chat Sidebar */
        .chat-sidebar {
            width: 260px;
            background: #f7f7f8;
            border-right: 1px solid #e5e5e5;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .new-chat-btn {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            color: #374151;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .new-chat-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }

        .alerts-button-sidebar {
            padding: 0.75rem;
            background: #dc2626;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .alerts-button-sidebar:hover {
            background: #b91c1c;
        }

        .alerts-badge-sidebar {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #fbbf24;
            color: #000;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            font-weight: 700;
            border: 2px solid white;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .chat-history-item {
            padding: 0.75rem;
            margin-bottom: 0.25rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .chat-history-item:hover {
            background: #ffffff;
            border-color: #e5e5e5;
        }

        .chat-history-item.active {
            background: #ffffff;
            border-color: #dc2626;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .chat-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: #111827;
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }

        .chat-preview {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .chat-time {
            font-size: 0.7rem;
            color: #9ca3af;
        }

        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid #e5e5e5;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #dc2626;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .user-name {
            font-weight: 500;
            color: #111827;
        }

        /* Main Chat Area */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            overflow: hidden;
        }

        /* Chat Top Header */
        .chat-top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid #e5e5e5;
            background: #ffffff;
        }

        .chat-title-area h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
            margin: 0 0 0.25rem 0;
        }

        .chat-subtitle {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.5rem;
            background: #f9fafb;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }

        /* Messages Container */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            position: relative;
            background: #ffffff;
        }

        .messages-wrapper {
            min-height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 2rem;
        }

        /* Welcome Section */
        .welcome-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .welcome-logo {
            margin-bottom: 1rem;
        }

        .logo-text {
            font-size: 2rem;
            font-weight: 700;
            color: #dc2626;
        }

        .welcome-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 2rem;
        }

        .welcome-suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .suggestion-btn {
            padding: 1rem 1.5rem;
            background: #f9fafb;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            color: #374151;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .suggestion-btn:hover {
            background: #f3f4f6;
            border-color: #dc2626;
            transform: translateY(-1px);
        }

        /* Chat Messages */
        .message {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #dc2626;
            color: white;
        }

        .message.assistant .message-avatar {
            background: #f3f4f6;
            color: #374151;
        }

        .message-content {
            flex: 1;
            max-width: 70%;
        }

        .message.user .message-content {
            background: #dc2626;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 18px 18px 4px 18px;
        }

        .message.assistant .message-content {
            background: #f9fafb;
            color: #374151;
            padding: 0.75rem 1rem;
            border-radius: 18px 18px 18px 4px;
            border: 1px solid #e5e5e5;
        }

        /* Scroll to Bottom Button */
        .scroll-to-bottom {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            background: #ffffff;
            border: 1px solid #e5e5e5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .scroll-to-bottom:hover {
            background: #f9fafb;
            transform: translateY(-1px);
        }

        /* Chat Input Area */
        .chat-input-area {
            padding: 1rem 2rem 2rem 2rem;
            background: #ffffff;
            border-top: 1px solid #e5e5e5;
        }

        .input-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: #f9fafb;
            border: 1px solid #e5e5e5;
            border-radius: 24px;
            transition: all 0.2s ease;
        }

        .input-wrapper:focus-within {
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .chat-input-field {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            resize: none;
            font-size: 1rem;
            line-height: 1.5;
            color: #111827;
            min-height: 24px;
            max-height: 120px;
        }

        .chat-input-field::placeholder {
            color: #9ca3af;
        }

        .send-btn {
            width: 32px;
            height: 32px;
            background: #dc2626;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .send-btn:hover {
            background: #b91c1c;
            transform: scale(1.05);
        }

        .send-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .input-footer {
            text-align: center;
            margin-top: 0.75rem;
        }

        .input-hint {
            font-size: 0.75rem;
            color: #9ca3af;
        }

        /* Alerts Panel Overlay */
        .alerts-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .alerts-panel-content {
            width: 500px;
            max-width: 90vw;
            max-height: 80vh;
            background: white;
            border-radius: 12px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        /* Alerts Button */
        .alerts-button {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .alerts-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }

        .bell-icon {
            color: white;
        }

        .alerts-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #fbbf24;
            color: #000;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            border: 2px solid white;
        }

        .alerts-text {
            font-size: 0.9rem;
        }

        /* Alerts Panel */
        .alerts-panel {
            position: absolute;
            top: 100%;
            right: 2rem;
            width: 500px;
            max-width: 90vw;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            margin-top: 1rem;
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .alerts-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: #000;
        }

        .close-alerts {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-alerts:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #000;
        }

        /* Alerts Tabs */
        .alerts-tabs {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .alert-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .alert-tab.active {
            color: #dc2626;
            border-bottom-color: #dc2626;
            background: rgba(220, 38, 38, 0.05);
        }

        .alert-tab:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        /* Alerts Content */
        .alerts-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .alert-tab-content {
            display: none;
            padding: 1.5rem;
        }

        .alert-tab-content.active {
            display: block;
        }

        /* Alert Items */
        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            border-color: #dc2626;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1);
        }

        .alert-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(220, 38, 38, 0.1);
            border-radius: 50%;
        }

        .alert-details {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: #000;
            margin-bottom: 0.25rem;
        }

        .alert-description {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .alert-time {
            color: #dc2626;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .alert-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .alert-action-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #dc2626;
            background: #dc2626;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .alert-action-btn.secondary {
            background: transparent;
            color: #dc2626;
        }

        .alert-action-btn:hover {
            transform: translateY(-1px);
        }

        /* Schedule Form */
        .schedule-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: #000;
            font-size: 0.9rem;
        }

        .form-control {
            padding: 0.75rem;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .form-control textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
        }

        .btn-primary {
            flex: 1;
            padding: 0.75rem 1.5rem;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }

        .btn-secondary {
            padding: 0.75rem 1.5rem;
            background: transparent;
            color: #dc2626;
            border: 1px solid #dc2626;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(220, 38, 38, 0.1);
        }

        /* Alert History */
        .alert-history {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .history-item {
            padding: 1rem;
            border-left: 3px solid #dc2626;
            background: rgba(220, 38, 38, 0.05);
            border-radius: 0 6px 6px 0;
        }

        .history-date {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .history-alert {
            font-weight: 500;
            color: #000;
            margin-bottom: 0.25rem;
        }

        .history-action {
            font-size: 0.8rem;
            color: #dc2626;
        }

        /* Chat Interface */
        .chat-interface {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #ffffff;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background: #ffffff;
        }

        .chat-input-container {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 1.5rem 2rem;
            background: #ffffff;
        }

        .chat-input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 1rem;
            background: #f8f9fa;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 1rem;
        }

        .chat-input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            color: #000000;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            resize: none;
            min-height: 24px;
            max-height: 120px;
            line-height: 1.5;
        }

        .chat-input::placeholder {
            color: #6b7280;
        }

        .send-button {
            background: #dc2626;
            border: none;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .send-button:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }

        .send-button:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        /* Pattern Recognition Dashboard */
        .pattern-dashboard {
            padding: 4rem 0;
            background: rgba(255, 255, 255, 0.02);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .main-chart {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            position: relative;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(59, 130, 246, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc2626;
            animation: pulse 2s infinite;
        }

        .chart-area {
            height: 300px;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1) 0%, rgba(185, 28, 28, 0.05) 100%);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .pattern-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 200"><path d="M20,180 Q60,160 100,140 T180,120 T260,100 T340,80" fill="none" stroke="rgba(59,130,246,0.8)" stroke-width="3"/><circle cx="340" cy="80" r="6" fill="%233b82f6"/><path d="M200,120 Q220,110 240,105 T280,95" fill="none" stroke="rgba(255,100,100,0.8)" stroke-width="2" stroke-dasharray="5,5"/></svg>');
            background-size: cover;
        }

        .pattern-annotations {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(15, 20, 25, 0.9);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 1rem;
            font-size: 0.8rem;
        }

        .annotation-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .annotation-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        /* Insights Panel */
        .insights-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .insight-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .insight-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .insight-title {
            font-size: 1rem;
            font-weight: 600;
            color: #dc2626;
        }

        .confidence-badge {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: #fff;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .insight-description {
            font-size: 0.9rem;
            color: #b8c5d6;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        /* Loading Animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Typing Indicator */
        .typing-indicator .message-content {
            padding: 1rem !important;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        .typing-dots span:nth-child(3) { animation-delay: 0s; }

        @keyframes typing {
            0%, 80%, 100% { 
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Message Styling */
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
        }

        .user-message {
            background: rgba(220, 38, 38, 0.1);
            border-left: 3px solid #dc2626;
            margin-left: 20px;
        }

        .ai-message {
            background: rgba(30, 58, 138, 0.2);
            border-left: 3px solid #1e3a8a;
            margin-right: 20px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .timestamp {
            color: #9ca3af;
        }

        .message-content {
            line-height: 1.5;
        }

        .insight-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .metric-item {
            text-align: center;
            padding: 0.75rem;
            background: rgba(220, 38, 38, 0.1);
            border-radius: 8px;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #dc2626;
        }

        .metric-label {
            font-size: 0.7rem;
            color: #b8c5d6;
            margin-top: 0.25rem;
        }

        /* Dynamic Chat Messages */
        .message {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .user-message {
            align-items: flex-end;
        }

        .ai-message {
            align-items: flex-start;
        }

        .message-content {
            max-width: 85%;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            font-size: 0.95rem;
            line-height: 1.6;
            word-wrap: break-word;
        }

        .user-message .message-content {
            background: #dc2626;
            color: #ffffff;
        }

        .ai-message .message-content {
            background: #f8f9fa;
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #000000;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #6b7280;
            text-align: center;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .empty-state-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* API Response Formatting */
        .ai-message .message-content strong {
            color: #dc2626;
            font-weight: 600;
        }

        .ai-message .message-content br {
            line-height: 1.8;
        }

        .loading-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .loading-dots {
            display: inline-flex;
            gap: 2px;
        }

        .loading-dots span {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #dc2626;
            animation: loading 1.4s ease-in-out infinite both;
        }

        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loading {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }



        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Footer */
        .footer {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            padding: 2rem 0;
            border-top: 1px solid rgba(220, 38, 38, 0.3);
            margin-top: 4rem;
        }

        .simple-footer {
            text-align: center;
            color: #ffffff;
        }

        .footer-brand {
            font-size: 1.2rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .footer-tagline {
            font-size: 0.9rem;
            color: #b8c5d6;
            font-style: italic;
            opacity: 0.9;
        }









        /* Responsive */
        @media (max-width: 768px) {
            .financial-news-ticker {
                height: 45px;
            }
            
            body {
                padding-bottom: 55px; /* Adjust for smaller mobile ticker */
            }
            
            .news-item {
                font-size: 0.85rem;
            }
            
            .news-badge {
                font-size: 0.7rem;
                padding: 0.25rem 0.6rem;
            }
            
            .news-ticker-content {
                gap: 2.5rem;
                animation: scroll-financial-news 100s linear infinite;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .gpt-layout {
                flex-direction: column;
                height: auto;
            }

            .chat-sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #e5e5e5;
            }

            .chat-history {
                max-height: 200px;
            }

            .sidebar-header {
                padding: 0.75rem;
            }

            .new-chat-btn {
                font-size: 0.8rem;
                padding: 0.6rem 0.8rem;
            }

            .welcome-suggestions {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .suggestion-btn {
                padding: 0.75rem 1rem;
                font-size: 0.85rem;
            }

            .messages-wrapper {
                padding: 1rem;
            }

            .chat-input-area {
                padding: 1rem;
            }

            .message-content {
                max-width: 85%;
            }

            .chat-top-header {
                padding: 1rem;
            }

            .chat-title-area h2 {
                font-size: 1.1rem;
            }



            .search-suggestions {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            nav {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .nav-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .market-toggles {
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.5rem;
            }
            
            .rotating-ticker-container {
                min-width: 150px;
                padding: 0.25rem 0.5rem;
            }
            
            .ticker-label {
                font-size: 0.6rem;
                min-width: 40px;
                padding: 0.15rem 0.3rem;
            }
            
            .rotating-ticker-content {
                height: 40px;
            }
            
            .ticker-symbol {
                font-size: 0.65rem;
            }
            
            .ticker-price {
                font-size: 0.8rem;
            }
            
            .ticker-change {
                font-size: 0.6rem;
            }

            .nyc-time-toggle {
                order: -1;
                margin-bottom: 0.5rem;
            }


        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <div class="nav-left">
                <a href="index.html" class="logo">LiveTrader.ai</a>
                <ul class="nav-links">
                    <li class="dropdown">
                        <a href="#search" class="dropdown-toggle">Search ▼</a>
                        <div class="dropdown-menu search-menu">
                            <a href="#" class="dropdown-period">1️⃣ Current</a>
                            <a href="#" class="dropdown-period">2️⃣ 2015-2025</a>
                            <a href="#" class="dropdown-period">3️⃣ 2005-2015</a>
                            <a href="#" class="dropdown-period">4️⃣ 1995-2005</a>
                            <a href="#" class="dropdown-period">5️⃣ Before 1995</a>
                        </div>
                    </li>
                    <li><a href="#explainability">Explainability</a></li>
                    <li class="dropdown">
                        <a href="#patterns" class="dropdown-toggle">Patterns ▼</a>
                        <div class="dropdown-menu patterns-menu">
                            <a href="#" class="dropdown-category">📈 Bullish Patterns</a>
                            <a href="#" class="dropdown-category">📉 Bearish Patterns</a>
                            <a href="#" class="dropdown-category">➡️ Neutral / Continuation Patterns</a>
                            <a href="#" class="dropdown-category">📈 Bullish Trading Signals</a>
                            <a href="#" class="dropdown-category">📉 Bearish Trading Signals</a>
                            <a href="#" class="dropdown-category">➡️ Neutral / Continuation Trading Signals</a>
                        </div>
                    </li>
                </ul>
            </div>
            
            <div class="market-toggles" id="marketToggles">
                <!-- Stock Indices Rotating Ticker -->
                <div class="rotating-ticker-container" id="stockIndicesTicker">
                    <div class="ticker-label">📈 INDICES</div>
                    <div class="rotating-ticker-content">
                        <div class="ticker-item active" data-symbol="NASDAQ">
                            <span class="ticker-symbol">NASDAQ</span>
                            <span class="ticker-price" id="nasdaq-price">15,234.56</span>
                            <span class="ticker-change positive" id="nasdaq-change">+1.23%</span>
                        </div>
                        <div class="ticker-item" data-symbol="SP500">
                            <span class="ticker-symbol">S&P 500</span>
                            <span class="ticker-price" id="sp500-price">4,567.89</span>
                            <span class="ticker-change positive" id="sp500-change">+0.89%</span>
                        </div>
                        <div class="ticker-item" data-symbol="DOW">
                            <span class="ticker-symbol">DOW 30</span>
                            <span class="ticker-price" id="dow-price">34,567.12</span>
                            <span class="ticker-change negative" id="dow-change">-0.45%</span>
                        </div>
                    </div>
                </div>

                <!-- Commodities & Crypto Rotating Ticker -->
                <div class="rotating-ticker-container" id="commoditiesTicker">
                    <div class="ticker-label">🥇 ASSETS</div>
                    <div class="rotating-ticker-content">
                        <div class="ticker-item active" data-symbol="GOLD">
                            <span class="ticker-symbol">GOLD</span>
                            <span class="ticker-price" id="gold-price">$1,987.45</span>
                            <span class="ticker-change positive" id="gold-change">+0.67%</span>
                        </div>
                        <div class="ticker-item" data-symbol="OIL">
                            <span class="ticker-symbol">OIL</span>
                            <span class="ticker-price" id="oil-price">$78.92</span>
                            <span class="ticker-change positive" id="oil-change">+1.45%</span>
                        </div>
                        <div class="ticker-item" data-symbol="BTC">
                            <span class="ticker-symbol">BITCOIN</span>
                            <span class="ticker-price" id="btc-price">$43,567.89</span>
                            <span class="ticker-change positive" id="btc-change">+2.34%</span>
                        </div>
                        <div class="ticker-item" data-symbol="ETH">
                            <span class="ticker-symbol">ETHEREUM</span>
                            <span class="ticker-price" id="eth-price">$2,987.65</span>
                            <span class="ticker-change positive" id="eth-change">+1.89%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="nyc-time-toggle" onclick="toggleTimeZone()">
                <div class="american-flag"></div>
                <div class="nyc-indicator"></div>
                <div class="nyc-info">
                    <div class="nyc-location">New York City</div>
                    <div class="nyc-time" id="nycTime">--:--:-- --</div>
                    <div class="market-status" id="marketStatus">MARKET CLOSED</div>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="hero" id="home">
            <div class="full-interface">
                <div class="gpt-layout">
                    <!-- Chat History Sidebar -->
                    <div class="chat-sidebar">
                        <div class="sidebar-header">
                            <button class="new-chat-btn" onclick="startNewChat()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                New Chat
                            </button>
                            <button class="alerts-button-sidebar" id="alertsButtonSidebar" onclick="toggleAlertsPanel()">
                                <svg class="bell-icon" width="18" height="18" viewBox="0 0 24 24" fill="none">
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span class="alerts-badge-sidebar" id="alertsBadgeSidebar">3</span>
                            </button>
                        </div>
                        
                        <div class="chat-history">
                            <div class="chat-history-item active" onclick="loadChat('current')">
                                <div class="chat-title">Pattern Recognition Analysis</div>
                                <div class="chat-preview">What patterns are emerging in NASDAQ...</div>
                                <div class="chat-time">Today</div>
                            </div>
                            
                            <div class="chat-history-item" onclick="loadChat('yesterday')">
                                <div class="chat-title">Market Volatility Discussion</div>
                                <div class="chat-preview">Explain the VIX spike and its implications...</div>
                                <div class="chat-time">Yesterday</div>
                            </div>
                            
                            <div class="chat-history-item" onclick="loadChat('week')">
                                <div class="chat-title">Gold Price Analysis</div>
                                <div class="chat-preview">RSI indicators showing oversold conditions...</div>
                                <div class="chat-time">This week</div>
                            </div>
                            
                            <div class="chat-history-item" onclick="loadChat('crypto')">
                                <div class="chat-title">Crypto Market Trends</div>
                                <div class="chat-preview">Bitcoin correlation with traditional markets...</div>
                                <div class="chat-time">Dec 15</div>
                            </div>
                            
                            <div class="chat-history-item" onclick="loadChat('earnings')">
                                <div class="chat-title">Earnings Season Impact</div>
                                <div class="chat-preview">How earnings reports affect sector rotation...</div>
                                <div class="chat-time">Dec 10</div>
                            </div>
                        </div>
                        
                        <div class="sidebar-footer">
                            <div class="user-info">
                                <div class="user-avatar">👤</div>
                                <div class="user-name">Trader</div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Chat Area -->
                    <div class="chat-main">
                        <!-- Chat Header -->
                        <div class="chat-top-header">
                            <div class="chat-title-area">
                                <h2 id="currentChatTitle">Pattern Recognition Analysis</h2>
                                <div class="chat-subtitle">LiveTrader.ai - Where History Meets Intelligence</div>
                            </div>
                            <div class="chat-actions">
                                <button class="action-btn" onclick="shareChat()" title="Share Chat">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                        <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8M16 6l-4-4-4 4M12 2v13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                                <button class="action-btn" onclick="clearChat()" title="Clear Chat">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Messages Container -->
                        <div class="messages-container" id="messagesContainer">
                            <div class="messages-wrapper" id="messagesWrapper">
                                <!-- Welcome Message -->
                                <div class="welcome-section">
                                    <div class="welcome-logo">
                                        <span class="logo-text">LiveTrader.ai</span>
                                    </div>
                                    <div class="welcome-title">How can I help you analyze the markets today?</div>
                                    <div class="welcome-suggestions">
                                        <button class="suggestion-btn" onclick="sendSuggestion('What patterns are emerging in NASDAQ this week?')">
                                            📈 Analyze NASDAQ patterns
                                        </button>
                                        <button class="suggestion-btn" onclick="sendSuggestion('Explain the 2008 financial crisis impact on markets')">
                                            📊 Historical market analysis
                                        </button>
                                        <button class="suggestion-btn" onclick="sendSuggestion('What technical indicators suggest for Gold right now?')">
                                            💰 Gold technical analysis
                                        </button>
                                        <button class="suggestion-btn" onclick="sendSuggestion('Compare current market conditions to previous bear markets')">
                                            🔍 Market comparison
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Messages will be added here dynamically -->
                                <div id="chatMessages"></div>
                            </div>
                            
                            <!-- Scroll to bottom button -->
                            <button class="scroll-to-bottom" id="scrollToBottom" onclick="scrollToBottom()" style="display: none;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M7 13l3 3 7-7M7 6l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Chat Input -->
                        <div class="chat-input-area">
                            <div class="input-container">
                                <div class="input-wrapper">
                                    <textarea 
                                        id="chatInput"
                                        class="chat-input-field" 
                                        placeholder="Message LiveTrader.ai..."
                                        rows="1"
                                        onkeydown="handleInputKeydown(event)"
                                        oninput="adjustTextareaHeight(this)"
                                    ></textarea>
                                    <button id="sendButton" class="send-btn" onclick="sendMessage()">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="input-footer">
                                    <span class="input-hint">LiveTrader.ai can make mistakes. Consider checking important information.</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Alerts Panel (Hidden by default) -->
                    <div class="alerts-panel-overlay" id="alertsPanel" style="display: none;">
                        <div class="alerts-panel-content">
                            <div class="alerts-header">
                                <h3>Scheduled Insights & Alerts</h3>
                                <button class="close-alerts" onclick="toggleAlertsPanel()">×</button>
                            </div>
                            
                            <div class="alerts-tabs">
                                <button class="alert-tab active" data-tab="active">Active Alerts</button>
                                <button class="alert-tab" data-tab="schedule">Schedule New</button>
                                <button class="alert-tab" data-tab="history">History</button>
                            </div>
                            
                            <div class="alerts-content">
                                <!-- Active Alerts Tab -->
                                <div class="alert-tab-content active" id="active-tab">
                                    <div class="alert-item">
                                        <div class="alert-icon">📈</div>
                                        <div class="alert-details">
                                            <div class="alert-title">NASDAQ Pattern Alert</div>
                                            <div class="alert-description">Ascending triangle formation detected - potential breakout in 2-3 days</div>
                                            <div class="alert-time">Next check: Today 4:00 PM EST</div>
                                        </div>
                                        <div class="alert-actions">
                                            <button class="alert-action-btn">View</button>
                                            <button class="alert-action-btn secondary">Edit</button>
                                        </div>
                                    </div>
                                    
                                    <div class="alert-item">
                                        <div class="alert-icon">⚠️</div>
                                        <div class="alert-details">
                                            <div class="alert-title">Market Volatility Watch</div>
                                            <div class="alert-description">VIX above 25 - monitor defensive positions</div>
                                            <div class="alert-time">Daily at 9:30 AM EST</div>
                                        </div>
                                        <div class="alert-actions">
                                            <button class="alert-action-btn">View</button>
                                            <button class="alert-action-btn secondary">Edit</button>
                                        </div>
                                    </div>
                                    
                                    <div class="alert-item">
                                        <div class="alert-icon">💰</div>
                                        <div class="alert-details">
                                            <div class="alert-title">Gold Price Momentum</div>
                                            <div class="alert-description">RSI oversold condition - potential reversal opportunity</div>
                                            <div class="alert-time">Every 4 hours</div>
                                        </div>
                                        <div class="alert-actions">
                                            <button class="alert-action-btn">View</button>
                                            <button class="alert-action-btn secondary">Edit</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Schedule New Tab -->
                                <div class="alert-tab-content" id="schedule-tab">
                                    <div class="schedule-form">
                                        <div class="form-group">
                                            <label>Alert Type</label>
                                            <select class="form-control">
                                                <option>Pattern Recognition Alert</option>
                                                <option>Price Movement Alert</option>
                                                <option>Technical Indicator Alert</option>
                                                <option>Market Sentiment Alert</option>
                                                <option>Custom Query Alert</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label>Market/Symbol</label>
                                            <select class="form-control">
                                                <option>NASDAQ</option>
                                                <option>S&P 500</option>
                                                <option>DOW 30</option>
                                                <option>Gold</option>
                                                <option>Bitcoin</option>
                                                <option>Ethereum</option>
                                                <option>Custom Symbol</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label>Frequency</label>
                                            <select class="form-control">
                                                <option>Real-time</option>
                                                <option>Every 15 minutes</option>
                                                <option>Hourly</option>
                                                <option>Every 4 hours</option>
                                                <option>Daily at market open</option>
                                                <option>Daily at market close</option>
                                                <option>Weekly</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label>Alert Condition</label>
                                            <textarea class="form-control" placeholder="Describe what you want to be alerted about (e.g., 'Notify me when NASDAQ shows a bullish divergence pattern')"></textarea>
                                        </div>
                                        
                                        <div class="form-actions">
                                            <button class="btn-primary">Create Alert</button>
                                            <button class="btn-secondary">Save as Template</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- History Tab -->
                                <div class="alert-tab-content" id="history-tab">
                                    <div class="alert-history">
                                        <div class="history-item">
                                            <div class="history-date">Today 2:15 PM</div>
                                            <div class="history-alert">📈 NASDAQ breakout confirmed - 2.3% gain as predicted</div>
                                            <div class="history-action">Alert triggered successfully</div>
                                        </div>
                                        
                                        <div class="history-item">
                                            <div class="history-date">Yesterday 4:00 PM</div>
                                            <div class="history-alert">⚠️ Market volatility increased - VIX at 28.5</div>
                                            <div class="history-action">Alert sent to 12 brokers</div>
                                        </div>
                                        
                                        <div class="history-item">
                                            <div class="history-date">Dec 18, 3:30 PM</div>
                                            <div class="history-alert">💰 Gold RSI reversal - Entry point identified</div>
                                            <div class="history-action">Alert generated insights</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>






    </main>

    <!-- Streaming Financial News Ticker -->
    <div class="financial-news-ticker">
        <div class="news-ticker-wrapper">
            <div class="news-ticker-content" id="financialNewsTicker">
                <div class="news-item breaking">
                    <span class="news-badge">🔴 BREAKING</span>
                    <span class="news-text">Fed Chair Powell signals dovish pivot - Markets rally on rate cut expectations</span>
                </div>
                <div class="news-item market">
                    <span class="news-badge">📈 MARKET</span>
                    <span class="news-text">S&P 500 breaks key resistance at 4,600 - Technical analysis shows 78% probability of continued rally</span>
                </div>
                <div class="news-item crypto">
                    <span class="news-badge">₿ CRYPTO</span>
                    <span class="news-text">Bitcoin institutional adoption accelerates - MicroStrategy adds $500M to holdings</span>
                </div>
                <div class="news-item earnings">
                    <span class="news-badge">💼 EARNINGS</span>
                    <span class="news-text">Q4 earnings beat rate hits 72% - Tech sector leads with average 15% upside surprise</span>
                </div>
                <div class="news-item ai-insight">
                    <span class="news-badge">🤖 AI INSIGHT</span>
                    <span class="news-text">Pattern recognition detects 89% similarity to 2020 pre-rally conditions</span>
                </div>
                <div class="news-item global">
                    <span class="news-badge">🌍 GLOBAL</span>
                    <span class="news-text">European markets surge 2.1% on ECB dovish stance - DAX hits new yearly high</span>
                </div>
                <div class="news-item commodities">
                    <span class="news-badge">🥇 COMMODITIES</span>
                    <span class="news-text">Gold breaks $2,000 resistance as dollar weakens - Next target $2,050</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="simple-footer">
                <div class="footer-brand">LiveTrader.ai 2025</div>
                <div class="footer-tagline">Where History Meets Intelligence</div>
            </div>
        </div>
    </footer>

    <script>
        // NYC Time and Market Status
        function updateNYCTime() {
            const now = new Date();
            const nycTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
            
            // Format time
            const timeString = nycTime.toLocaleTimeString('en-US', {
                hour12: true,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            document.getElementById('nycTime').textContent = timeString;
            
            // Determine market status
            const day = nycTime.getDay(); // 0 = Sunday, 6 = Saturday
            const hour = nycTime.getHours();
            const minute = nycTime.getMinutes();
            const totalMinutes = hour * 60 + minute;
            
            // Market hours: Monday-Friday 9:30 AM - 4:00 PM EST
            const marketOpen = 9 * 60 + 30; // 9:30 AM
            const marketClose = 16 * 60; // 4:00 PM
            
            let status = 'MARKET CLOSED';
            let statusColor = '#dc2626';
            
            if (day >= 1 && day <= 5) { // Monday to Friday
                if (totalMinutes >= marketOpen && totalMinutes < marketClose) {
                    status = 'MARKET OPEN';
                    statusColor = '#00ff88';
                } else if (totalMinutes >= marketOpen - 30 && totalMinutes < marketOpen) {
                    status = 'PRE-MARKET';
                    statusColor = '#fbbf24';
                } else if (totalMinutes >= marketClose && totalMinutes < marketClose + 240) {
                    status = 'AFTER-HOURS';
                    statusColor = '#fbbf24';
                }
            }
            
            const statusElement = document.getElementById('marketStatus');
            statusElement.textContent = status;
            statusElement.style.color = statusColor;
        }
        
        // Toggle between different time zones (future feature)
        function toggleTimeZone() {
            // For now, just update the time
            updateNYCTime();
            
            // Future: cycle through NYC, London, Tokyo, etc.
            console.log('Time zone toggle clicked - NYC time updated');
        }
        
        // Update time every second
        setInterval(updateNYCTime, 1000);
        
        // Initial update
        updateNYCTime();

        // Rotating Ticker System
        class RotatingTicker {
            constructor(containerId, rotationInterval = 3000) {
                this.container = document.getElementById(containerId);
                this.items = this.container ? this.container.querySelectorAll('.ticker-item') : [];
                this.currentIndex = 0;
                this.rotationInterval = rotationInterval;
                this.isRotating = false;
                this.init();
            }

            init() {
                if (this.items.length === 0) return;
                
                // Set first item as active
                this.items[0].classList.add('active');
                
                // Start rotation
                this.startRotation();
                
                // Add click handler to container
                if (this.container) {
                    this.container.addEventListener('click', () => {
                        this.nextItem();
                    });
                }
            }

            startRotation() {
                if (this.isRotating || this.items.length <= 1) return;
                
                this.isRotating = true;
                this.rotationTimer = setInterval(() => {
                    this.nextItem();
                }, this.rotationInterval);
            }

            stopRotation() {
                if (this.rotationTimer) {
                    clearInterval(this.rotationTimer);
                    this.isRotating = false;
                }
            }

            nextItem() {
                if (this.items.length === 0) return;
                
                // Remove active class from current item
                this.items[this.currentIndex].classList.remove('active');
                
                // Move to next item
                this.currentIndex = (this.currentIndex + 1) % this.items.length;
                
                // Add active class to new item
                this.items[this.currentIndex].classList.add('active');
                
                // Trigger market selection event
                const symbol = this.items[this.currentIndex].dataset.symbol;
                this.updateSelectedMarket(symbol);
            }

            updateSelectedMarket(symbol) {
                console.log(`Selected market: ${symbol}`);
                // Trigger custom event for market selection
                const event = new CustomEvent('marketToggleChanged', {
                    detail: { symbol: symbol }
                });
                window.dispatchEvent(event);
            }

            pauseRotation() {
                this.stopRotation();
            }

            resumeRotation() {
                this.startRotation();
            }
        }

        // Initialize rotating tickers
        let stockIndicesTicker, commoditiesTicker;

        function initializeRotatingTickers() {
            stockIndicesTicker = new RotatingTicker('stockIndicesTicker', 4000);
            commoditiesTicker = new RotatingTicker('commoditiesTicker', 4500);
            
            // Add hover pause functionality
            const containers = document.querySelectorAll('.rotating-ticker-container');
            containers.forEach(container => {
                container.addEventListener('mouseenter', () => {
                    if (container.id === 'stockIndicesTicker') {
                        stockIndicesTicker.pauseRotation();
                    } else if (container.id === 'commoditiesTicker') {
                        commoditiesTicker.pauseRotation();
                    }
                });
                
                container.addEventListener('mouseleave', () => {
                    if (container.id === 'stockIndicesTicker') {
                        stockIndicesTicker.resumeRotation();
                    } else if (container.id === 'commoditiesTicker') {
                        commoditiesTicker.resumeRotation();
                    }
                });
            });
        }

        async function updateMarketToggles() {
            const tickers = [
                { symbol: 'IXIC', id: 'nasdaq', name: 'NASDAQ' },
                { symbol: 'SPX', id: 'sp500', name: 'S&P 500' },
                { symbol: 'DJI', id: 'dow', name: 'DOW 30' },
                { symbol: 'GLD', id: 'gold', name: 'GOLD' },
                { symbol: 'CL=F', id: 'oil', name: 'OIL' },
                { symbol: 'BTC-USD', id: 'btc', name: 'BTC' },
                { symbol: 'ETH-USD', id: 'eth', name: 'ETH' }
            ];

            for (const ticker of tickers) {
                try {
                    await updateTogglePrice(ticker);
                } catch (error) {
                    console.warn(`Failed to update ${ticker.name}:`, error);
                    updateToggleError(ticker.id);
                }
            }
        }

        async function updateTogglePrice(ticker) {
            // Using market data manager if available
            if (window.marketDataManager) {
                try {
                    const quote = await window.marketDataManager.getRealTimeQuote(ticker.symbol);
                    updateToggleDisplay(ticker.id, quote.price, quote.change, quote.changePercent);
                    return;
                } catch (error) {
                    console.warn(`Market data manager failed for ${ticker.symbol}:`, error);
                }
            }
            
            // Fallback to demo data
            updateToggleDemo(ticker);
        }

        function updateToggleDemo(ticker) {
            // Demo data for when real API is not available
            const demoPrices = {
                'nasdaq': { price: '15,234.56', change: 1.23 },
                'sp500': { price: '4,567.89', change: 0.89 },
                'dow': { price: '34,567.12', change: -0.45 },
                'gold': { price: '$1,987.45', change: 0.67 },
                'btc': { price: '$43,567.89', change: 2.34 },
                'eth': { price: '$2,987.65', change: 1.89 }
            };
            
            const demo = demoPrices[ticker.id];
            if (demo) {
                updateToggleDisplay(ticker.id, demo.price, demo.change, demo.change);
            }
        }

        async function updateTickerPrice(ticker) {
            // Using Alpha Vantage API for stock data
            if (ticker.symbol.includes('-USD')) {
                // For crypto, use a different approach or API
                updateTickerCrypto(ticker);
            } else {
                // For stocks/ETFs
                const url = `${ALPHA_VANTAGE_BASE_URL}?function=GLOBAL_QUOTE&symbol=${ticker.symbol}&apikey=${ALPHA_VANTAGE_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data['Global Quote']) {
                    const quote = data['Global Quote'];
                    const price = parseFloat(quote['05. price']).toFixed(2);
                    const change = parseFloat(quote['09. change']).toFixed(2);
                    const changePercent = parseFloat(quote['10. change percent'].replace('%', '')).toFixed(2);
                    
                    updateTickerDisplay(ticker.id, price, change, changePercent);
                } else {
                    updateTickerError(ticker.id);
                }
            }
        }

        function updateTickerCrypto(ticker) {
            // Placeholder for crypto prices - you can integrate with CoinGecko or similar
            const cryptoPrices = {
                'BTC-USD': { price: '45,230', change: '+2.3%' },
                'ETH-USD': { price: '2,890', change: '+1.8%' }
            };
            
            const crypto = cryptoPrices[ticker.symbol];
            if (crypto) {
                document.getElementById(`${ticker.id}-price`).textContent = `$${crypto.price}`;
                const changeElement = document.getElementById(`${ticker.id}-change`);
                changeElement.textContent = crypto.change;
                changeElement.className = `ticker-change ${crypto.change.startsWith('+') ? 'positive' : 'negative'}`;
            }
        }

        function updateTickerDisplay(tickerId, price, change, changePercent) {
            document.getElementById(`${tickerId}-price`).textContent = `$${price}`;
            const changeElement = document.getElementById(`${tickerId}-change`);
            const changeText = `${change >= 0 ? '+' : ''}${change} (${changePercent}%)`;
            changeElement.textContent = changeText;
            changeElement.className = `ticker-change ${change >= 0 ? 'positive' : 'negative'}`;
        }

        function updateTickerError(tickerId) {
            document.getElementById(`${tickerId}-price`).textContent = 'Error';
            document.getElementById(`${tickerId}-change`).textContent = '--';
        }

        // Initialize rotating tickers
        initializeRotatingTickers();
        
        // Update market toggles every 30 seconds
        updateMarketToggles();
        setInterval(updateMarketToggles, 30000);

        // Financial News Ticker System
        class FinancialNewsTicker {
            constructor() {
                this.newsItems = [];
                this.currentIndex = 0;
                this.isUpdating = false;
                this.apiKey = 'demo'; // Replace with actual Yahoo Finance API key
                this.initializeTicker();
            }

            initializeTicker() {
                this.loadInitialNews();
                this.startNewsUpdates();
                this.setupTickerInteractions();
            }

            loadInitialNews() {
                this.newsItems = [
                    {
                        type: 'breaking',
                        badge: '🔴 BREAKING',
                        text: 'Fed Chair Powell signals dovish pivot - Markets rally on rate cut expectations',
                        timestamp: Date.now(),
                        source: 'Federal Reserve'
                    },
                    {
                        type: 'market',
                        badge: '📈 MARKET',
                        text: 'S&P 500 breaks key resistance at 4,600 - Technical analysis shows 78% probability of continued rally',
                        timestamp: Date.now() - 300000,
                        source: 'Market Analysis'
                    },
                    {
                        type: 'crypto',
                        badge: '₿ CRYPTO',
                        text: 'Bitcoin institutional adoption accelerates - MicroStrategy adds $500M to holdings',
                        timestamp: Date.now() - 600000,
                        source: 'Crypto News'
                    },
                    {
                        type: 'ai-insight',
                        badge: '🤖 AI INSIGHT',
                        text: 'Pattern recognition detects 89% similarity to 2020 pre-rally conditions',
                        timestamp: Date.now() - 900000,
                        source: 'LiveTrader AI'
                    }
                ];
            }

            async fetchYahooFinanceNews() {
                try {
                    // Yahoo Finance API integration (requires CORS proxy in production)
                    const response = await fetch(`https://query1.finance.yahoo.com/v1/finance/search?q=market%20news&lang=en-US&region=US&quotesCount=6&newsCount=10&enableFuzzyQuery=false&quotesQueryId=tss_match_phrase_query&multiQuoteQueryId=multi_quote_single_token_query&newsQueryId=news_cie_vespa&enableCb=true&enableNavLinks=true&enableEnhancedTrivialQuery=true`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        return this.parseYahooNews(data);
                    } else {
                        throw new Error('Yahoo Finance API unavailable');
                    }
                } catch (error) {
                    console.warn('Yahoo Finance API error, using simulated news:', error);
                    return this.generateSimulatedNews();
                }
            }

            parseYahooNews(data) {
                if (!data.news || !Array.isArray(data.news)) {
                    return this.generateSimulatedNews();
                }

                return data.news.slice(0, 3).map(item => ({
                    type: this.categorizeNews(item.title),
                    badge: this.getBadgeForCategory(this.categorizeNews(item.title)),
                    text: item.title,
                    timestamp: Date.now(),
                    source: item.publisher || 'Yahoo Finance'
                }));
            }

            categorizeNews(title) {
                const lowerTitle = title.toLowerCase();
                if (lowerTitle.includes('fed') || lowerTitle.includes('federal reserve') || lowerTitle.includes('rate')) {
                    return 'breaking';
                } else if (lowerTitle.includes('bitcoin') || lowerTitle.includes('crypto') || lowerTitle.includes('ethereum')) {
                    return 'crypto';
                } else if (lowerTitle.includes('earnings') || lowerTitle.includes('quarterly')) {
                    return 'earnings';
                } else if (lowerTitle.includes('gold') || lowerTitle.includes('oil') || lowerTitle.includes('commodity')) {
                    return 'commodities';
                } else {
                    return 'market';
                }
            }

            getBadgeForCategory(category) {
                const badges = {
                    'breaking': '🔴 BREAKING',
                    'market': '📈 MARKET',
                    'crypto': '₿ CRYPTO',
                    'earnings': '💼 EARNINGS',
                    'global': '🌍 GLOBAL',
                    'commodities': '🥇 COMMODITIES',
                    'ai-insight': '🤖 AI INSIGHT'
                };
                return badges[category] || '📈 MARKET';
            }

            generateSimulatedNews() {
                const newsTemplates = [
                    {
                        type: 'breaking',
                        templates: [
                            'Fed officials hint at March rate pause amid economic uncertainty',
                            'Treasury Secretary announces new banking regulations',
                            'Inflation data shows unexpected cooling in core CPI',
                            'Emergency Fed meeting scheduled for next week'
                        ]
                    },
                    {
                        type: 'market',
                        templates: [
                            'NASDAQ futures up {percent}% in pre-market trading',
                            'Russell 2000 leads market gains with {percent}% surge',
                            'VIX drops to {level} as market volatility decreases',
                            'Tech sector rotation continues with {percent}% outperformance'
                        ]
                    },
                    {
                        type: 'crypto',
                        templates: [
                            'Bitcoin breaks ${price}K resistance in overnight trading',
                            'Ethereum network upgrade boosts institutional confidence',
                            'Major pension fund allocates ${amount}M to crypto portfolio',
                            'Regulatory clarity drives crypto market cap above ${cap}T'
                        ]
                    },
                    {
                        type: 'ai-insight',
                        templates: [
                            'AI pattern analysis identifies {confidence}% probability of {direction} breakout',
                            'Machine learning detects unusual options flow in {sector} sector',
                            'Historical correlation analysis suggests {timeframe} consolidation period',
                            'Sentiment analysis shows {sentiment} shift in institutional positioning'
                        ]
                    }
                ];

                const randomCategory = newsTemplates[Math.floor(Math.random() * newsTemplates.length)];
                const randomTemplate = randomCategory.templates[Math.floor(Math.random() * randomCategory.templates.length)];

                let newsText = randomTemplate
                    .replace('{percent}', (Math.random() * 3 + 0.5).toFixed(1))
                    .replace('{level}', (Math.random() * 10 + 15).toFixed(1))
                    .replace('{price}', (Math.random() * 20 + 40).toFixed(0))
                    .replace('{amount}', (Math.random() * 800 + 200).toFixed(0))
                    .replace('{cap}', (Math.random() * 1 + 2).toFixed(1))
                    .replace('{confidence}', (Math.random() * 25 + 70).toFixed(0))
                    .replace('{direction}', ['bullish', 'bearish'][Math.floor(Math.random() * 2)])
                    .replace('{sector}', ['Technology', 'Healthcare', 'Energy', 'Financials'][Math.floor(Math.random() * 4)])
                    .replace('{timeframe}', ['2-week', '1-month', '6-week'][Math.floor(Math.random() * 3)])
                    .replace('{sentiment}', ['bullish', 'bearish', 'neutral'][Math.floor(Math.random() * 3)]);

                return [{
                    type: randomCategory.type,
                    badge: this.getBadgeForCategory(randomCategory.type),
                    text: newsText,
                    timestamp: Date.now(),
                    source: 'LiveTrader AI'
                }];
            }

            async updateNewsContent() {
                if (this.isUpdating) return;
                this.isUpdating = true;

                try {
                    const newNews = await this.fetchYahooFinanceNews();
                    
                    // Add new news items to the beginning
                    newNews.forEach(item => {
                        this.newsItems.unshift(item);
                    });

                    // Keep only the latest 15 items
                    this.newsItems = this.newsItems.slice(0, 15);

                    // Update the ticker display
                    this.refreshTickerDisplay();
                } catch (error) {
                    console.error('Error updating financial news:', error);
                } finally {
                    this.isUpdating = false;
                }
            }

            refreshTickerDisplay() {
                const tickerContent = document.getElementById('financialNewsTicker');
                if (!tickerContent) return;

                const newsHTML = this.newsItems.map(item => `
                    <div class="news-item ${item.type}">
                        <span class="news-badge">${item.badge}</span>
                        <span class="news-text">${item.text}</span>
                    </div>
                `).join('');

                tickerContent.innerHTML = newsHTML;
            }

            startNewsUpdates() {
                // Update news every 3 minutes
                setInterval(() => {
                    this.updateNewsContent();
                }, 180000);

                // Add AI insights every 5 minutes
                setInterval(() => {
                    this.addAIInsight();
                }, 300000);
            }

            addAIInsight() {
                const insights = [
                    'Pattern recognition identifies ascending triangle formation in SPY with 82% breakout probability',
                    'Cross-asset correlation analysis suggests defensive rotation beginning in next 48 hours',
                    'Volume profile analysis indicates institutional accumulation at current levels',
                    'Momentum oscillators align with historical pre-rally conditions from Q2 2023',
                    'Options flow analysis shows unusual call activity in semiconductor sector',
                    'Sentiment divergence detected: retail bearish while institutions accumulate'
                ];

                const randomInsight = insights[Math.floor(Math.random() * insights.length)];
                
                const newInsight = {
                    type: 'ai-insight',
                    badge: '🤖 AI INSIGHT',
                    text: randomInsight,
                    timestamp: Date.now(),
                    source: 'LiveTrader AI'
                };

                this.newsItems.unshift(newInsight);
                this.newsItems = this.newsItems.slice(0, 15);
                this.refreshTickerDisplay();
            }

            setupTickerInteractions() {
                const tickerContainer = document.querySelector('.financial-news-ticker');
                if (!tickerContainer) return;

                // Pause animation on hover
                tickerContainer.addEventListener('mouseenter', () => {
                    const tickerContent = document.getElementById('financialNewsTicker');
                    if (tickerContent) {
                        tickerContent.style.animationPlayState = 'paused';
                    }
                });

                tickerContainer.addEventListener('mouseleave', () => {
                    const tickerContent = document.getElementById('financialNewsTicker');
                    if (tickerContent) {
                        tickerContent.style.animationPlayState = 'running';
                    }
                });

                // Click to show news details
                tickerContainer.addEventListener('click', (e) => {
                    const newsItem = e.target.closest('.news-item');
                    if (newsItem) {
                        const newsText = newsItem.querySelector('.news-text').textContent;
                        this.showNewsModal(newsText);
                    }
                });
            }

            showNewsModal(newsText) {
                const modal = document.createElement('div');
                modal.className = 'financial-news-modal';
                modal.innerHTML = `
                    <div class="news-modal-content">
                        <div class="news-modal-header">
                            <h3>📰 Financial News Detail</h3>
                            <button class="close-modal" onclick="this.parentElement.parentElement.parentElement.remove()">×</button>
                        </div>
                        <div class="news-modal-body">
                            <p>${newsText}</p>
                            <div class="news-modal-actions">
                                <button onclick="navigator.clipboard.writeText('${newsText}')">📋 Copy News</button>
                                <button onclick="window.open('https://finance.yahoo.com/news/', '_blank')">🔗 More News</button>
                                <button onclick="window.open('https://www.federalreserve.gov/newsevents.htm', '_blank')">🏛️ Fed News</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Add modal styles
                if (!document.getElementById('financial-news-modal-styles')) {
                    const styles = document.createElement('style');
                    styles.id = 'financial-news-modal-styles';
                    styles.textContent = `
                        .financial-news-modal {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0, 0, 0, 0.85);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 10000;
                            backdrop-filter: blur(5px);
                        }
                        .news-modal-content {
                            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
                            border: 1px solid rgba(59, 130, 246, 0.3);
                            border-radius: 16px;
                            max-width: 600px;
                            width: 90%;
                            max-height: 80vh;
                            overflow-y: auto;
                            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
                        }
                        .news-modal-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 1.5rem;
                            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
                        }
                        .news-modal-header h3 {
                            margin: 0;
                            color: #ffffff;
                            font-size: 1.2rem;
                        }
                        .close-modal {
                            background: none;
                            border: none;
                            font-size: 1.5rem;
                            cursor: pointer;
                            color: #9ca3af;
                            padding: 0.5rem;
                            border-radius: 8px;
                            transition: all 0.2s;
                        }
                        .close-modal:hover {
                            background: rgba(239, 68, 68, 0.1);
                            color: #ef4444;
                        }
                        .news-modal-body {
                            padding: 1.5rem;
                        }
                        .news-modal-body p {
                            color: #e5e7eb;
                            line-height: 1.6;
                            margin-bottom: 1.5rem;
                            font-size: 1rem;
                        }
                        .news-modal-actions {
                            display: flex;
                            gap: 1rem;
                            flex-wrap: wrap;
                        }
                        .news-modal-actions button {
                            padding: 0.75rem 1.25rem;
                            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 0.9rem;
                            font-weight: 500;
                            transition: all 0.2s;
                            flex: 1;
                            min-width: 120px;
                        }
                        .news-modal-actions button:hover {
                            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
                            transform: translateY(-1px);
                            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
                        }
                    `;
                    document.head.appendChild(styles);
                }
            }
        }

        // Initialize Financial News Ticker
        const financialNewsTicker = new FinancialNewsTicker();
        
        // Alerts & Insights Functionality
        function toggleAlertsPanel() {
            const panel = document.getElementById('alertsPanel');
            const isVisible = panel.style.display !== 'none';
            
            if (isVisible) {
                panel.style.display = 'none';
            } else {
                panel.style.display = 'block';
                // Reset to active alerts tab
                switchAlertTab('active');
            }
        }

        function switchAlertTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.alert-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab contents
            document.querySelectorAll('.alert-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Add active class to selected tab
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Initialize alerts functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers for alert tabs
            document.querySelectorAll('.alert-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    switchAlertTab(tabName);
                });
            });

            // Close alerts panel when clicking outside
            document.addEventListener('click', function(event) {
                const panel = document.getElementById('alertsPanel');
                const button = document.getElementById('alertsButton');
                
                if (panel.style.display !== 'none' && 
                    !panel.contains(event.target) && 
                    !button.contains(event.target)) {
                    panel.style.display = 'none';
                }
            });

            // Simulate real-time alert updates
            setInterval(updateAlertsBadge, 30000); // Update every 30 seconds
        });

        function updateAlertsBadge() {
            // Simulate new alerts (in real implementation, this would fetch from backend)
            const badge = document.getElementById('alertsBadge');
            const currentCount = parseInt(badge.textContent);
            
            // Randomly add new alerts (demo purposes)
            if (Math.random() > 0.7) {
                badge.textContent = currentCount + 1;
                
                // Flash the button to indicate new alert
                const button = document.getElementById('alertsButton');
                button.style.animation = 'pulse 2s ease-in-out';
                setTimeout(() => {
                    button.style.animation = '';
                }, 2000);
            }
        }

        // Alert action handlers
        function viewAlert(alertId) {
            console.log('Viewing alert:', alertId);
            // In real implementation, this would show detailed alert information
            alert('Alert details would be shown here');
        }

        function editAlert(alertId) {
            console.log('Editing alert:', alertId);
            // In real implementation, this would open edit form
            switchAlertTab('schedule');
        }

        function createAlert() {
            console.log('Creating new alert');
            // In real implementation, this would save the alert to backend
            alert('Alert created successfully!');
            switchAlertTab('active');
        }
        
        // GPT-Style Chat Functionality
        let currentChatId = 'current';
        let messageHistory = [];
        let isAtBottom = true;

        function startNewChat() {
            // Clear current chat
            document.getElementById('chatMessages').innerHTML = '';
            document.querySelector('.welcome-section').style.display = 'block';
            messageHistory = [];
            
            // Update chat title
            document.getElementById('currentChatTitle').textContent = 'New Chat';
            
            // Remove active class from all history items
            document.querySelectorAll('.chat-history-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Focus input
            document.getElementById('chatInput').focus();
        }

        function loadChat(chatId) {
            // Remove active class from all items
            document.querySelectorAll('.chat-history-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to clicked item
            event.target.closest('.chat-history-item').classList.add('active');
            
            // Load chat content based on ID
            const chatTitles = {
                'current': 'Pattern Recognition Analysis',
                'yesterday': 'Market Volatility Discussion',
                'week': 'Gold Price Analysis',
                'crypto': 'Crypto Market Trends',
                'earnings': 'Earnings Season Impact'
            };
            
            document.getElementById('currentChatTitle').textContent = chatTitles[chatId] || 'Chat';
            currentChatId = chatId;
            
            // Hide welcome section when loading existing chat
            document.querySelector('.welcome-section').style.display = 'none';
            
            // Load sample messages for demo
            if (chatId !== 'current') {
                loadSampleMessages(chatId);
            }
        }

        function loadSampleMessages(chatId) {
            const sampleChats = {
                'yesterday': [
                    { type: 'user', content: 'What caused the VIX spike yesterday?' },
                    { type: 'assistant', content: 'The VIX spike was primarily driven by uncertainty around Federal Reserve policy decisions and geopolitical tensions. When the VIX rises above 25, it typically indicates heightened market anxiety and increased demand for portfolio hedging.' }
                ],
                'week': [
                    { type: 'user', content: 'Analyze gold price movements this week' },
                    { type: 'assistant', content: 'Gold has shown strong momentum this week, breaking above the $1,980 resistance level. The RSI indicates oversold conditions are being corrected, and the 50-day moving average is providing solid support. This suggests a potential continuation of the upward trend.' }
                ]
            };
            
            const messages = sampleChats[chatId] || [];
            const chatContainer = document.getElementById('chatMessages');
            chatContainer.innerHTML = '';
            
            messages.forEach(msg => {
                addMessageToChat(msg.type, msg.content, false);
            });
        }

        function sendSuggestion(text) {
            document.getElementById('chatInput').value = text;
            sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Hide welcome section
            document.querySelector('.welcome-section').style.display = 'none';
            
            // Add user message
            addMessageToChat('user', message);
            
            // Clear input
            input.value = '';
            adjustTextareaHeight(input);
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate AI response
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateAIResponse(message);
                addMessageToChat('assistant', response);
            }, 1500);
        }

        function addMessageToChat(type, content, scroll = true) {
            const chatContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = type === 'user' ? '👤' : '🤖';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">${content}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            
            if (scroll) {
                scrollToBottom();
            }
            
            // Add to message history
            messageHistory.push({ type, content, timestamp: Date.now() });
        }

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant typing-indicator';
            typingDiv.id = 'typingIndicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">🤖</div>
                <div class="message-content">
                    <div class="typing-dots">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateAIResponse(message) {
            const responses = {
                'nasdaq': 'Based on current NASDAQ analysis, I\'m seeing a strong ascending triangle pattern forming over the past two weeks. The 15,000 level is acting as key resistance, but volume patterns suggest a potential breakout. Historical data shows similar formations led to 3-7% gains in 68% of cases since 2020.',
                'pattern': 'I\'ve identified several key patterns in the current market structure. The most notable is a bullish flag formation in the S&P 500, combined with a golden cross in the 50/200 day moving averages. This typically signals continued upward momentum.',
                'gold': 'Gold is showing classic oversold RSI conditions at 28.5, well below the 30 threshold. Historical analysis indicates this level has provided strong buying opportunities in 78% of instances over the past decade. The $1,950 support level remains intact.',
                'crisis': 'The 2008 financial crisis created a unique market pattern we call "capitulation cascade." Markets fell 57% from peak to trough, but the recovery showed distinct phases: initial bounce (20%), consolidation (6 months), then sustained growth. Current conditions show some similarities in volatility patterns.',
                'default': 'Based on my analysis of historical market patterns and current technical indicators, I can provide insights into market trends, pattern recognition, and risk assessment. What specific aspect of market analysis would you like me to focus on?'
            };
            
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('nasdaq')) return responses.nasdaq;
            if (lowerMessage.includes('pattern')) return responses.pattern;
            if (lowerMessage.includes('gold')) return responses.gold;
            if (lowerMessage.includes('2008') || lowerMessage.includes('crisis')) return responses.crisis;
            
            return responses.default;
        }

        function scrollToBottom() {
            const container = document.getElementById('messagesContainer');
            container.scrollTop = container.scrollHeight;
            document.getElementById('scrollToBottom').style.display = 'none';
            isAtBottom = true;
        }

        function handleInputKeydown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        function shareChat() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('Chat link copied to clipboard!');
            });
        }

        function clearChat() {
            if (confirm('Are you sure you want to clear this chat?')) {
                startNewChat();
            }
        }

        // Monitor scroll position
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('messagesContainer');
            const scrollBtn = document.getElementById('scrollToBottom');
            
            container.addEventListener('scroll', function() {
                const isNearBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 100;
                isAtBottom = isNearBottom;
                scrollBtn.style.display = isNearBottom ? 'none' : 'block';
            });
        });

        // Chat functionality
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendButton');
            const chatMessages = document.getElementById('chatMessages');
            const patternItems = document.querySelectorAll('.pattern-item');
            
            // Show empty state initially
            showEmptyState();
            
            function showEmptyState() {
                chatMessages.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🤖</div>
                        <div class="empty-state-text">Ask me about market patterns and trading signals</div>
                        <div class="empty-state-subtext">Select a pattern from the left or ask any trading question</div>
                    </div>
                `;
            }
            
            // Handle pattern item clicks
            patternItems.forEach(pattern => {
                pattern.addEventListener('click', function() {
                    const patternName = this.textContent;
                    chatInput.value = `Tell me about ${patternName} pattern and show me recent examples`;
                    chatInput.focus();
                    autoResize();
                });
            });

            // Handle dropdown category clicks
            const dropdownCategories = document.querySelectorAll('.dropdown-category');
            dropdownCategories.forEach(category => {
                category.addEventListener('click', function(e) {
                    e.preventDefault();
                    const categoryName = this.textContent.replace(/📈|📉|➡️/g, '').trim();
                    chatInput.value = `Show me all ${categoryName} and explain how to identify them in current market conditions`;
                    chatInput.focus();
                    autoResize();
                    
                    // Hide dropdown after selection
                    const dropdown = this.closest('.dropdown');
                    if (dropdown) {
                        const dropdownMenu = dropdown.querySelector('.dropdown-menu');
                        dropdownMenu.style.opacity = '0';
                        dropdownMenu.style.visibility = 'hidden';
                    }
                });
            });

            // Handle historical period clicks
            const dropdownPeriods = document.querySelectorAll('.dropdown-period');
            dropdownPeriods.forEach(period => {
                period.addEventListener('click', function(e) {
                    e.preventDefault();
                    const periodName = this.textContent.replace(/[1-5]️⃣/g, '').trim();
                    chatInput.value = `Analyze market patterns and trading signals from ${periodName} period and explain the key characteristics of that era`;
                    chatInput.focus();
                    autoResize();
                    
                    // Hide dropdown after selection
                    const dropdown = this.closest('.dropdown');
                    if (dropdown) {
                        const dropdownMenu = dropdown.querySelector('.dropdown-menu');
                        dropdownMenu.style.opacity = '0';
                        dropdownMenu.style.visibility = 'hidden';
                    }
                });
            });

            // Improve dropdown stability for all dropdowns
            const dropdowns = document.querySelectorAll('.dropdown');
            dropdowns.forEach(dropdown => {
                const dropdownMenu = dropdown.querySelector('.dropdown-menu');
                let hoverTimeout;
                
                dropdown.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                    dropdownMenu.style.opacity = '1';
                    dropdownMenu.style.visibility = 'visible';
                });
                
                dropdown.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(() => {
                        dropdownMenu.style.opacity = '0';
                        dropdownMenu.style.visibility = 'hidden';
                    }, 100);
                });
                
                dropdownMenu.addEventListener('mouseenter', function() {
                    clearTimeout(hoverTimeout);
                });
                
                dropdownMenu.addEventListener('mouseleave', function() {
                    hoverTimeout = setTimeout(() => {
                        dropdownMenu.style.opacity = '0';
                        dropdownMenu.style.visibility = 'hidden';
                    }, 100);
                });
            });
            
            // Auto-resize textarea
            function autoResize() {
                chatInput.style.height = 'auto';
                chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
            }
            
            chatInput.addEventListener('input', autoResize);
            
            // Handle send message
            function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;
                
                // Clear empty state if it exists
                const emptyState = chatMessages.querySelector('.empty-state');
                if (emptyState) {
                    chatMessages.innerHTML = '';
                }
                
                // Add user message
                addMessage(message, 'user');
                
                // Clear input
                chatInput.value = '';
                autoResize();
                
                // Show typing indicator
                showTypingIndicator();
                
                // Connect to Alpha Vantage API
                analyzeWithAlphaVantage(message);
            }
            
            function addMessage(content, type) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}-message`;
                messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message ai-message typing-indicator';
                typingDiv.innerHTML = '<div class="message-content">Analyzing...</div>';
                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            function hideTypingIndicator() {
                const typingIndicator = chatMessages.querySelector('.typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }
            
            // Send button click
            sendButton.addEventListener('click', sendMessage);
            
            // Enter key to send
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Alpha Vantage API Integration
            const ALPHA_VANTAGE_API_KEY = 'YOUR_API_KEY_HERE'; // Replace with your actual API key
            const ALPHA_VANTAGE_BASE_URL = 'https://www.alphavantage.co/query';

            async function analyzeWithAlphaVantage(query) {
                try {
                    // Extract stock symbol from query
                    const symbol = extractStockSymbol(query);
                    
                    if (symbol) {
                        // Fetch real market data
                        const marketData = await fetchMarketData(symbol);
                        const technicalData = await fetchTechnicalIndicators(symbol);
                        
                        // Generate intelligent response
                        const response = generateIntelligentResponse(query, symbol, marketData, technicalData);
                        
                        hideTypingIndicator();
                        addMessage(response, 'ai');
                    } else {
                        // Handle general trading questions
                        const response = handleGeneralTradingQuery(query);
                        hideTypingIndicator();
                        addMessage(response, 'ai');
                    }
                } catch (error) {
                    console.error('Alpha Vantage API Error:', error);
                    hideTypingIndicator();
                    addMessage('I encountered an issue fetching market data. Please check your API connection and try again.', 'ai');
                }
            }

            function extractStockSymbol(query) {
                // Common stock symbols pattern matching
                const symbolPatterns = [
                    /\b([A-Z]{1,5})\b/g, // Basic symbol pattern
                    /\b(AAPL|MSFT|GOOGL|AMZN|TSLA|META|NVDA|AMD|INTC|CRM|NFLX|DIS|BA|GE|F|GM|JPM|BAC|WFC|GS|MS|V|MA|PG|JNJ|KO|PFE|MRK|XOM|CVX|SPY|QQQ|IWM|VTI|VOO)\b/gi
                ];
                
                for (let pattern of symbolPatterns) {
                    const matches = query.match(pattern);
                    if (matches && matches.length > 0) {
                        return matches[0].toUpperCase();
                    }
                }
                return null;
            }

            async function fetchMarketData(symbol) {
                const url = `${ALPHA_VANTAGE_BASE_URL}?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${ALPHA_VANTAGE_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data['Error Message']) {
                    throw new Error('Invalid symbol or API limit reached');
                }
                
                return data;
            }

            async function fetchTechnicalIndicators(symbol) {
                const indicators = {};
                
                try {
                    // Fetch RSI
                    const rsiUrl = `${ALPHA_VANTAGE_BASE_URL}?function=RSI&symbol=${symbol}&interval=daily&time_period=14&series_type=close&apikey=${ALPHA_VANTAGE_API_KEY}`;
                    const rsiResponse = await fetch(rsiUrl);
                    const rsiData = await rsiResponse.json();
                    indicators.rsi = rsiData;

                    // Fetch MACD
                    const macdUrl = `${ALPHA_VANTAGE_BASE_URL}?function=MACD&symbol=${symbol}&interval=daily&series_type=close&apikey=${ALPHA_VANTAGE_API_KEY}`;
                    const macdResponse = await fetch(macdUrl);
                    const macdData = await macdResponse.json();
                    indicators.macd = macdData;

                    // Fetch Bollinger Bands
                    const bbUrl = `${ALPHA_VANTAGE_BASE_URL}?function=BBANDS&symbol=${symbol}&interval=daily&time_period=20&series_type=close&apikey=${ALPHA_VANTAGE_API_KEY}`;
                    const bbResponse = await fetch(bbUrl);
                    const bbData = await bbResponse.json();
                    indicators.bollinger = bbData;

                } catch (error) {
                    console.warn('Some technical indicators failed to load:', error);
                }
                
                return indicators;
            }

            function generateIntelligentResponse(query, symbol, marketData, technicalData) {
                const timeSeries = marketData['Time Series (Daily)'];
                if (!timeSeries) {
                    return `I couldn't fetch current data for ${symbol}. Please verify the symbol is correct.`;
                }

                const dates = Object.keys(timeSeries).sort().reverse();
                const latestDate = dates[0];
                const latestData = timeSeries[latestDate];
                const previousData = timeSeries[dates[1]];

                const currentPrice = parseFloat(latestData['4. close']);
                const previousPrice = parseFloat(previousData['4. close']);
                const priceChange = currentPrice - previousPrice;
                const percentChange = ((priceChange / previousPrice) * 100).toFixed(2);

                let response = `<strong>${symbol} Analysis (${latestDate})</strong><br><br>`;
                response += `<strong>Current Price:</strong> $${currentPrice.toFixed(2)}<br>`;
                response += `<strong>Change:</strong> ${priceChange >= 0 ? '+' : ''}$${priceChange.toFixed(2)} (${percentChange}%)<br>`;
                response += `<strong>Volume:</strong> ${parseInt(latestData['5. volume']).toLocaleString()}<br><br>`;

                // Pattern analysis based on recent price action
                const patternAnalysis = analyzePatterns(timeSeries, dates.slice(0, 20));
                response += `<strong>Pattern Analysis:</strong><br>${patternAnalysis}<br><br>`;

                // Technical indicators
                if (technicalData.rsi && technicalData.rsi['Technical Analysis: RSI']) {
                    const rsiData = technicalData.rsi['Technical Analysis: RSI'];
                    const latestRSI = Object.values(rsiData)[0];
                    if (latestRSI) {
                        const rsiValue = parseFloat(latestRSI['RSI']).toFixed(2);
                        response += `<strong>RSI (14):</strong> ${rsiValue} - `;
                        if (rsiValue > 70) response += 'Overbought territory<br>';
                        else if (rsiValue < 30) response += 'Oversold territory<br>';
                        else response += 'Neutral zone<br>';
                    }
                }

                // Trading recommendation
                response += `<br><strong>Trading Insight:</strong><br>`;
                response += generateTradingInsight(query, currentPrice, percentChange, patternAnalysis);

                return response;
            }

            function analyzePatterns(timeSeries, recentDates) {
                const prices = recentDates.map(date => parseFloat(timeSeries[date]['4. close']));
                const highs = recentDates.map(date => parseFloat(timeSeries[date]['2. high']));
                const lows = recentDates.map(date => parseFloat(timeSeries[date]['3. low']));

                // Simple pattern detection
                const trend = prices[0] > prices[prices.length - 1] ? 'upward' : 'downward';
                const volatility = calculateVolatility(prices);
                
                let analysis = `Recent ${recentDates.length}-day trend is ${trend}. `;
                
                if (volatility > 0.05) {
                    analysis += 'High volatility detected - potential breakout pattern forming.';
                } else if (volatility < 0.02) {
                    analysis += 'Low volatility - consolidation pattern, watch for breakout.';
                } else {
                    analysis += 'Moderate volatility - normal price action.';
                }

                // Check for potential support/resistance
                const maxPrice = Math.max(...highs);
                const minPrice = Math.min(...lows);
                const currentPrice = prices[0];
                
                if (currentPrice > maxPrice * 0.95) {
                    analysis += ' Price near resistance level.';
                } else if (currentPrice < minPrice * 1.05) {
                    analysis += ' Price near support level.';
                }

                return analysis;
            }

            function calculateVolatility(prices) {
                const returns = [];
                for (let i = 1; i < prices.length; i++) {
                    returns.push((prices[i-1] - prices[i]) / prices[i]);
                }
                const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
                const variance = returns.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / returns.length;
                return Math.sqrt(variance);
            }

            function generateTradingInsight(query, currentPrice, percentChange, patternAnalysis) {
                let insight = '';
                
                if (query.toLowerCase().includes('bullish') || query.toLowerCase().includes('buy')) {
                    insight = 'For bullish positions, watch for breakout above recent resistance with strong volume confirmation.';
                } else if (query.toLowerCase().includes('bearish') || query.toLowerCase().includes('sell')) {
                    insight = 'For bearish positions, look for breakdown below support levels with increasing volume.';
                } else if (Math.abs(percentChange) > 3) {
                    insight = 'Significant price movement detected. Consider waiting for consolidation before entering positions.';
                } else {
                    insight = 'Current price action suggests range-bound trading. Look for breakout signals before taking directional positions.';
                }
                
                return insight;
            }

            function handleGeneralTradingQuery(query) {
                const lowerQuery = query.toLowerCase();
                
                if (lowerQuery.includes('pattern') && lowerQuery.includes('recognition')) {
                    return 'Pattern recognition in trading involves identifying recurring price formations that historically lead to predictable outcomes. Common patterns include triangles, flags, head and shoulders, and double tops/bottoms. Each pattern provides insights into potential future price movements based on market psychology and supply/demand dynamics.';
                }
                
                if (lowerQuery.includes('risk management')) {
                    return 'Effective risk management is crucial for trading success. Key principles include: 1) Never risk more than 1-2% of your account per trade, 2) Use stop-losses to limit downside, 3) Maintain proper position sizing, 4) Diversify across different assets and timeframes, 5) Keep a trading journal to learn from both wins and losses.';
                }
                
                if (lowerQuery.includes('technical analysis')) {
                    return 'Technical analysis studies price charts and trading volumes to predict future price movements. Key tools include trend lines, support/resistance levels, moving averages, RSI, MACD, and candlestick patterns. The premise is that all market information is reflected in price, and history tends to repeat itself.';
                }
                
                return 'I can help you analyze specific stocks, explain trading patterns, discuss risk management, or provide insights on technical analysis. Try asking about a specific stock symbol (like AAPL, TSLA, or SPY) or mention a trading pattern you\'d like to learn about.';
            }
        });
    </script>

    <!-- Market Data Integration -->
    <script src="api_config.js"></script>
    <script src="market_data_integration.js"></script>
    <script src="enhanced_market_ticker.js"></script>
    
    <!-- Backend Integration -->
    <script src="frontend_integration.js"></script>
</body>
</html>